---
title: 培训
author: essviv
date: 2017-01-25 05:34:25+0800
---

# 培训

## 数据库开发

### 单一的数据源或集群的代理

### 异构数据源： hibernate, spring-data(for redis, hbase)

* 提供统一的API
* 动态生成操作
* 优化性能
	* 异步并行加载框架
	* 热点缓存
	* 恶意访问的拦截、值班表扫描的拦截
	* 按需加载
	

### 淘宝技术魔方技术架构
*  数据源层（DB， 日志） --->   计算层（hadoop集群+hdfs，云梯； nosql集群，银河）----> 存储层 ----> 查询层  ----> 服务层
*  TimeTunnel: 读日志增量的工具
*  DataX: 异构数据源之间导入导出数据的工具（构架+插件）

### 数据库的优化（开发人员）
* DB的优化原理
	* 优化器模块
	* 执行计划（oracle会对这部分进行缓存，mysql不会对这部分缓存)
	* 学会查看执行计划和性能损耗
	* innodb_buffer_pool_size对性能有决定性的影响
	
* 查询优化
	* 索引的利弊
	* 索引的限制： 索引的计算、函数、数据类型转换均会导致索引失效.
	* 重量级的关键字的执行原理
		* join
		* order by
		* group by:先排序再分组
		* distinct: 先分组再从每组中取一条记录
	* 表机制
		* innodb行锁是通过事务来实现的
		* 行锁升级为表锁的情况: 索引失效、间隙锁、死锁
	* mysql的新技术
		* 源码安装使用ICC编译器
		* HandlerSocket（绕过mysql的优化器模块)
		* percona: percona数据库， xtrdb存储引擎（可完全替代innodb）， xtrbackup（可完全替代hotbackup）
	* 数据库的表设计
		* 范式与非范式结合使用: 适当冗余数据避免join, 常用字段与不常用字段垂直拆分(大字段)
## 缓存架构(b/s结构的项目中有哪些缓存可以做)
* 页面缓存： OSCache, EHCache, 页面静态化(IO, xml+xslt)
* 页面局部缓存: 标签类的技术， OSCache, EHCache, ESI(标准, JAVA的实现称为JESI）
* 浏览器的缓存
	* 优缺点(慎用)
	* html5(最被看好)
		* 更丰富的标签、表单
		* canvas
		* webStorage
		* webSocket
* 反射代理服务器的缓存
	* 七层的软件负载均衡器: nginx（通过配置可直接缓存）
	* nginx(专做负载均衡) + squid(专做缓存)
* 数据库的前端缓存
	* 热点数据的缓存
		* 热点规则: 支持可配置
		* key规则： 一级缓存、二级缓存
		* 数据失效： 绝对失效、相对失效、事件失效（消息中间件, JMS）
	* 经常反复创建并销毁的对象
		* 享元模式: 建议使用软引用.
		* 前端的一些缓存: jquery中的data方法
	* 分布式的缓存服务器
		* Redis
			* 提供了更丰富的数据类型: list, set, hashes, string, hset(不仅仅是cache， 更多的是服务端的计算) 
			* 支持持久化: rdb持久化、aof持久化、无持久化（吞吐量最高）
				* rdb持久化: 快照文件
					* 持久化所需要的空间
					* 恢复需要多长时间
					* 对QPS的影响
				* aof持久化: 日志文件
			* 支持主备机制: master-slaver
				* master做读写，slave做持久化
				* master做写，slave做读
				* master宕机，slave接管（keepalived）
			* 消息中间件(非企业级): pubsub
			* 在线扩容、容量规划等内容
		* memcached
			* 内存存储：内存要求高，CPU要求低
			* 集中式缓存：多个实例之间不通讯，存在单点问题
			* SOCKET通讯，NIO编程： 网络带宽、Socket的连接数都是制约性能的因素
			* 内存分配: 全部预先分配，不存在内存碎片，不需要回收； slab, chunk, page(每次分配的内存大小，分配完内存后会按一定的大小划分成slab）
				* MemcachedClient官方
				* 淘宝memcached: xplatform asf
				* google的MSM(memcached session manager)
				* 新浪memcachedb(memcached的持久化)
		* GemFile
		* BKD
## 服务层
* webService(http+xml)
* RPC(tcp/ip)
	* 基础的RPC操作
	* 性能优化
		* io模型( 同步阻塞IO， 同步非阻塞IO， 多路复用IO(nio, 事件机制)， 异步IO)
		* 线程模型
	* netty, mina
	* 服务的透明化：服务框架中间件(dubbo)
	* 服务的治理： 自动注册与治理、配置、升降级 ----> 微服务
	* dubbo(dubboX) + 其它第三方开源项目, spring-cloud(更完整), spring-boot
## 总结
* B/S架构的目标
* 架构师的理论体系
* 非功能性需求（从需求到架构）
* 构架的的总体分层（前端、后台）
* 数据的优化( java, jvm, tomcat…)
* 合理的缓存架构